/*
 * Copyright 2015-2022 Adrià Giménez Pastor.
 *
 * This file is part of adriagipas/memus.
 *
 * adriagipas/memus is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * adriagipas/memus is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with adriagipas/memus.  If not, see <https://www.gnu.org/licenses/>.
 */
/*
 *  tiles8b.c - Implementació de 'tiles8b.h'.
 *
 */

#include <stddef.h>
#include <stdlib.h>

#include "tiles8b.h"




/*************/
/* CONSTANTS */
/*************/


static const unsigned char TILES[52][8]=
  {
    {0x7C,0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0x00}, /* 0 : A */
    {0xFC,0xC6,0xC6,0xFC,0xC6,0xC6,0xFC,0x00},
    {0x7C,0xC6,0xC0,0xC0,0xC0,0xC6,0x7C,0x00},
    {0xFC,0xC6,0xC6,0xC6,0xC6,0xC6,0xFC,0x00},
    {0x7E,0xC0,0xC0,0xF8,0xC0,0xC0,0x7E,0x00},
    {0x7E,0xC0,0xC0,0xF8,0xC0,0xC0,0xC0,0x00},
    {0x7C,0xC6,0xC0,0xCE,0xC6,0xC6,0x7E,0x00},
    {0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00},
    {0xFC,0x30,0x30,0x30,0x30,0x30,0xFC,0x00},
    {0x0C,0x0C,0x0C,0x0C,0xCC,0xCC,0x78,0x00},
    {0xC6,0xC6,0xCC,0xF8,0xCC,0xC6,0xC6,0x00},
    {0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x7E,0x00},
    {0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0x00},
    {0xFC,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x00},
    {0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00},
    {0xFC,0xC6,0xC6,0xC6,0xFC,0xC0,0xC0,0x00},
    {0x7C,0xC6,0xC6,0xC6,0xDE,0xCE,0x7C,0x00},
    {0xFC,0xC6,0xC6,0xC6,0xFC,0xCC,0xC6,0x00},
    {0x7C,0xC6,0xC0,0x7C,0x06,0xC6,0x7C,0x00},
    {0xFC,0x30,0x30,0x30,0x30,0x30,0x30,0x00},
    {0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00},
    {0xC6,0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x00},
    {0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00},
    {0xC6,0xC6,0x6C,0x38,0x6C,0xC6,0xC6,0x00},
    {0xCC,0xCC,0xCC,0x78,0x30,0x30,0x30,0x00},
    {0xFC,0x0C,0x18,0x30,0x60,0xC0,0xFC,0x00}, /* 25 : Z */
    {0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00}, /* 26 : 0 */
    {0x30,0x70,0x30,0x30,0x30,0x30,0x78,0x00},
    {0x7C,0xC6,0x06,0x7C,0xC0,0xC0,0xFE,0x00},
    {0xFC,0x06,0x06,0x3C,0x06,0x06,0xFC,0x00},
    {0x1E,0x36,0x66,0xC6,0xFE,0x06,0x06,0x00},
    {0xFE,0xC0,0xFC,0x06,0x06,0xC6,0x7C,0x00},
    {0x7C,0xC6,0xC0,0xFC,0xC6,0xC6,0x7C,0x00},
    {0x7E,0x06,0x0C,0x18,0x18,0x18,0x18,0x00},
    {0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00},
    {0x7C,0xC6,0xC6,0x7E,0x06,0xC6,0x7C,0x00}, /* 35 : 9 */
    {0xC0,0xE0,0xF0,0xF8,0xF0,0xE0,0xC0,0x00}, /* 36 : > */
    {0x18,0x38,0x78,0xF8,0x78,0x38,0x18,0x00}, /* 37 : < */
    {0x7C,0xC6,0xC0,0xC0,0xC0,0xD6,0x7C,0x10}, /* 38 : Ç */
    {0x30,0x18,0x00,0x7C,0xC6,0xFE,0xC6,0x00}, /* 39 : À */
    {0x30,0x18,0x7E,0xC0,0xF8,0xC0,0x7E,0x00}, /* 40 : È */
    {0x0C,0x18,0x7E,0xC0,0xF8,0xC0,0x7E,0x00}, /* 41 : É */
    {0x0C,0x18,0x00,0xFE,0x30,0x30,0xFE,0x00}, /* 42 : Í */
    {0x30,0x18,0x00,0x7C,0xC6,0xC6,0x7C,0x00}, /* 43 : Ò */
    {0x0C,0x18,0x00,0x7C,0xC6,0xC6,0x7C,0x00}, /* 44 : Ó */
    {0x0C,0x18,0x00,0xC6,0xC6,0xC6,0x7C,0x00}, /* 45 : Ú */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* 46 : blanc */
    {0x00,0x60,0x60,0x00,0x00,0x60,0x60,0x00}, /* 47 : : */
    {0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x00}, /* 48 : . */
    {0x00,0x00,0x00,0xFC,0xFC,0x00,0x00,0x00}, /* 49 : - */
    {0x00,0x30,0x30,0xFC,0xFC,0x30,0x30,0x00}, /* 50 : + */
    {0x30,0x30,0x30,0x30,0x00,0x30,0x30,0x00}  /* 51 : ! */
};




/*********/
/* ESTAT */
/*********/

/* char -> tile índex. */
static unsigned char _char2tile[256];




/*********************/
/* FUNCIONS PRIVADES */
/*********************/

static void
draw_tile (
           int       *fb,
           const int  fb_width,
           const int  tile,
           const int  x,
           const int  y,
           const int  fgcolor,
           const int  bgcolor,
           const int  flags
           )
{
  
  int offset, r, c;
  const unsigned char *pat;
  unsigned char byte;
  
  
  pat= TILES[tile];
  offset= y*8*fb_width + x*8;
  for ( r= 0; r < 8; ++r )
    {
      byte= pat[r];
      for ( c= 0; c < 8; ++c )
        {
          if ( byte&0x80 )
            {
              if ( !(flags&FG_TRANS) ) fb[offset+c]= fgcolor;
            }
          else
            {
              if ( !(flags&BG_TRANS) ) fb[offset+c]= bgcolor;
            }
          byte<<= 1;
        }
      offset+= fb_width;
    }
  
} /* end draw_tile */




/**********************/
/* FUNCIONS PÚBLIQUES */
/**********************/
#include <stdio.h>
void
tiles8b_draw_string (
        	     int        *fb,
        	     const int   fb_width,
        	     const char *string,
        	     int         x,
        	     const int   y,
        	     const int   fgcolor,
        	     const int   bgcolor,
        	     const int   flags
        	     )
{

  const char *p;
  
  
  for ( p= string; *p; ++p, ++x )
    draw_tile ( fb, fb_width, _char2tile[(unsigned char) *p],
        	x, y, fgcolor, bgcolor, flags );
  
} /* end tiles8b_draw_string */


void
init_tiles8b (void)
{

  int i;
  
  
  for ( i= 0; i < 256; ++i ) _char2tile[i]= 46; /* Blanc. */
  for ( i= 'A'; i <= 'Z'; ++i ) _char2tile[i]= ((unsigned char) i)-'A';
  for ( i= '0'; i <= '9'; ++i ) _char2tile[i]= ((unsigned char) i)-'0'+26;
  _char2tile['>']= 36;
  _char2tile['<']= 37;
  _char2tile['c']= 38;
  _char2tile['a']= 39;
  _char2tile['e']= 40; /* È */
  _char2tile['r']= 41; /* É */
  _char2tile['i']= 42;
  _char2tile['o']= 43; /* Ò */
  _char2tile['p']= 44; /* Ó */
  _char2tile['u']= 45;
  _char2tile[':']= 47;
  _char2tile['.']= 48;
  _char2tile['-']= 49;
  _char2tile['+']= 50;
  _char2tile['!']= 51;
  
} /* end init_tiles8b */
