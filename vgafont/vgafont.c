/*
 * Copyright 2021-2022 Adrià Giménez Pastor.
 *
 * This file is part of adriagipas/memus.
 *
 * adriagipas/memus is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * adriagipas/memus is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with adriagipas/memus.  If not, see <https://www.gnu.org/licenses/>.
 */
/*
 *  vgafont.c - Implementació de 'vgafont.h'
 *
 */


#include <assert.h>
#include <glib.h>
#include <stddef.h>
#include <stdlib.h>
#include <string.h>

#include "error.h"
#include "vgafont.h"




/*************/
/* CONSTANTS */
/*************/

static const unsigned char TILES[256][16]=
  {
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7e,0x81,0xa5,0x81,0x81,0xbd,
     0x99,0x81,0x81,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7e,0xff,0xdb,0xff,0xff,0xc3,
     0xe7,0xff,0xff,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x6c,0xfe,0xfe,0xfe,
     0xfe,0x7c,0x38,0x10,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x10,0x38,0x7c,0xfe,
     0x7c,0x38,0x10,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x18,0x3c,0x3c,0xe7,0xe7,
     0xe7,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x18,0x3c,0x7e,0xff,0xff,
     0x7e,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x3c,
     0x3c,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    {0xff,0xff,0xff,0xff,0xff,0xff,0xe7,0xc3,
     0xc3,0xe7,0xff,0xff,0xff,0xff,0xff,0xff},
    {0x00,0x00,0x00,0x00,0x00,0x3c,0x66,0x42,
     0x42,0x66,0x3c,0x00,0x00,0x00,0x00,0x00},
    {0xff,0xff,0xff,0xff,0xff,0xc3,0x99,0xbd,
     0xbd,0x99,0xc3,0xff,0xff,0xff,0xff,0xff},
    {0x00,0x00,0x1e,0x0e,0x1a,0x32,0x78,0xcc,
     0xcc,0xcc,0xcc,0x78,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x66,0x66,0x66,0x66,0x3c,
     0x18,0x7e,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3f,0x33,0x3f,0x30,0x30,0x30,
     0x30,0x70,0xf0,0xe0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7f,0x63,0x7f,0x63,0x63,0x63,
     0x63,0x67,0xe7,0xe6,0xc0,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x18,0x18,0xdb,0x3c,0xe7,
     0x3c,0xdb,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x80,0xc0,0xe0,0xf0,0xf8,0xfe,0xf8,
     0xf0,0xe0,0xc0,0x80,0x00,0x00,0x00,0x00},
    {0x00,0x02,0x06,0x0e,0x1e,0x3e,0xfe,0x3e,
     0x1e,0x0e,0x06,0x02,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x3c,0x7e,0x18,0x18,0x18,
     0x7e,0x3c,0x18,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,
     0x66,0x00,0x66,0x66,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7f,0xdb,0xdb,0xdb,0x7b,0x1b,
     0x1b,0x1b,0x1b,0x1b,0x00,0x00,0x00,0x00},
    {0x00,0x7c,0xc6,0x60,0x38,0x6c,0xc6,0xc6,
     0x6c,0x38,0x0c,0xc6,0x7c,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0xfe,0xfe,0xfe,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x3c,0x7e,0x18,0x18,0x18,
     0x7e,0x3c,0x18,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x3c,0x7e,0x18,0x18,0x18,
     0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x18,0x18,0x18,0x18,0x18,
     0x18,0x7e,0x3c,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x18,0x0c,0xfe,
     0x0c,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x30,0x60,0xfe,
     0x60,0x30,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xc0,
     0xc0,0xfe,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x24,0x66,0xff,
     0x66,0x24,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x10,0x38,0x38,0x7c,
     0x7c,0xfe,0xfe,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0xfe,0xfe,0x7c,0x7c,
     0x38,0x38,0x10,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x3c,0x3c,0x3c,0x18,0x18,
     0x18,0x00,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x66,0x66,0x66,0x24,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x6c,0x6c,0xfe,0x6c,0x6c,
     0x6c,0xfe,0x6c,0x6c,0x00,0x00,0x00,0x00},
    {0x18,0x18,0x7c,0xc6,0xc2,0xc0,0x7c,0x06,
     0x06,0x86,0xc6,0x7c,0x18,0x18,0x00,0x00},
    {0x00,0x00,0x00,0x00,0xc2,0xc6,0x0c,0x18,
     0x30,0x60,0xc6,0x86,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x38,0x6c,0x6c,0x38,0x76,0xdc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x30,0x30,0x30,0x60,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x0c,0x18,0x30,0x30,0x30,0x30,
     0x30,0x30,0x18,0x0c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x30,0x18,0x0c,0x0c,0x0c,0x0c,
     0x0c,0x0c,0x18,0x30,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x66,0x3c,0xff,
     0x3c,0x66,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x7e,
     0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x18,0x18,0x18,0x30,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfe,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x02,0x06,0x0c,0x18,
     0x30,0x60,0xc0,0x80,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x66,0xc3,0xc3,0xdb,0xdb,
     0xc3,0xc3,0x66,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x38,0x78,0x18,0x18,0x18,
     0x18,0x18,0x18,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0x06,0x0c,0x18,0x30,
     0x60,0xc0,0xc6,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0x06,0x06,0x3c,0x06,
     0x06,0x06,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x0c,0x1c,0x3c,0x6c,0xcc,0xfe,
     0x0c,0x0c,0x0c,0x1e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfe,0xc0,0xc0,0xc0,0xfc,0x06,
     0x06,0x06,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x38,0x60,0xc0,0xc0,0xfc,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfe,0xc6,0x06,0x06,0x0c,0x18,
     0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0xc6,0x7c,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0xc6,0x7e,0x06,
     0x06,0x06,0x0c,0x78,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,
     0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,
     0x00,0x18,0x18,0x30,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x06,0x0c,0x18,0x30,0x60,
     0x30,0x18,0x0c,0x06,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,
     0x7e,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x60,0x30,0x18,0x0c,0x06,
     0x0c,0x18,0x30,0x60,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0x0c,0x18,0x18,
     0x18,0x00,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x7c,0xc6,0xc6,0xde,0xde,
     0xde,0xdc,0xc0,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x10,0x38,0x6c,0xc6,0xc6,0xfe,
     0xc6,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfc,0x66,0x66,0x66,0x7c,0x66,
     0x66,0x66,0x66,0xfc,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x66,0xc2,0xc0,0xc0,0xc0,
     0xc0,0xc2,0x66,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xf8,0x6c,0x66,0x66,0x66,0x66,
     0x66,0x66,0x6c,0xf8,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfe,0x66,0x62,0x68,0x78,0x68,
     0x60,0x62,0x66,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfe,0x66,0x62,0x68,0x78,0x68,
     0x60,0x60,0x60,0xf0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x66,0xc2,0xc0,0xc0,0xde,
     0xc6,0xc6,0x66,0x3a,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0xc6,0xc6,0xc6,0xfe,0xc6,
     0xc6,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x18,0x18,0x18,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x1e,0x0c,0x0c,0x0c,0x0c,0x0c,
     0xcc,0xcc,0xcc,0x78,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xe6,0x66,0x66,0x6c,0x78,0x78,
     0x6c,0x66,0x66,0xe6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xf0,0x60,0x60,0x60,0x60,0x60,
     0x60,0x62,0x66,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0xe7,0xff,0xff,0xdb,0xc3,
     0xc3,0xc3,0xc3,0xc3,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0xe6,0xf6,0xfe,0xde,0xce,
     0xc6,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfc,0x66,0x66,0x66,0x7c,0x60,
     0x60,0x60,0x60,0xf0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xd6,0xde,0x7c,0x0c,0x0e,0x00,0x00},
    {0x00,0x00,0xfc,0x66,0x66,0x66,0x7c,0x6c,
     0x66,0x66,0x66,0xe6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x7c,0xc6,0xc6,0x60,0x38,0x0c,
     0x06,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xff,0xdb,0x99,0x18,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,
     0xc3,0x66,0x3c,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0xc3,0xc3,0xc3,0xc3,0xdb,
     0xdb,0xff,0x66,0x66,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0xc3,0x66,0x3c,0x18,0x18,
     0x3c,0x66,0xc3,0xc3,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0xc3,0xc3,0x66,0x3c,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xff,0xc3,0x86,0x0c,0x18,0x30,
     0x60,0xc1,0xc3,0xff,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x30,0x30,0x30,0x30,0x30,
     0x30,0x30,0x30,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x80,0xc0,0xe0,0x70,0x38,
     0x1c,0x0e,0x06,0x02,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x0c,0x0c,0x0c,0x0c,0x0c,
     0x0c,0x0c,0x0c,0x3c,0x00,0x00,0x00,0x00},
    {0x10,0x38,0x6c,0xc6,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00},
    {0x30,0x30,0x18,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xe0,0x60,0x60,0x78,0x6c,0x66,
     0x66,0x66,0x66,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7c,0xc6,0xc0,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x1c,0x0c,0x0c,0x3c,0x6c,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7c,0xc6,0xfe,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x38,0x6c,0x64,0x60,0xf0,0x60,
     0x60,0x60,0x60,0xf0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x76,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x7c,0x0c,0xcc,0x78,0x00},
    {0x00,0x00,0xe0,0x60,0x60,0x6c,0x76,0x66,
     0x66,0x66,0x66,0xe6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x18,0x00,0x38,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x06,0x06,0x00,0x0e,0x06,0x06,
     0x06,0x06,0x06,0x06,0x66,0x66,0x3c,0x00},
    {0x00,0x00,0xe0,0x60,0x60,0x66,0x6c,0x78,
     0x78,0x6c,0x66,0xe6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x38,0x18,0x18,0x18,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xe6,0xff,0xdb,
     0xdb,0xdb,0xdb,0xdb,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xdc,0x66,0x66,
     0x66,0x66,0x66,0x66,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7c,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xdc,0x66,0x66,
     0x66,0x66,0x66,0x7c,0x60,0x60,0xf0,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x76,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x7c,0x0c,0x0c,0x1e,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xdc,0x76,0x66,
     0x60,0x60,0x60,0xf0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7c,0xc6,0x60,
     0x38,0x0c,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x10,0x30,0x30,0xfc,0x30,0x30,
     0x30,0x30,0x36,0x1c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xcc,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xc3,0xc3,0xc3,
     0xc3,0x66,0x3c,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xc3,0xc3,0xc3,
     0xdb,0xdb,0xff,0x66,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xc3,0x66,0x3c,
     0x18,0x3c,0x66,0xc3,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7e,0x06,0x0c,0xf8,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xfe,0xcc,0x18,
     0x30,0x60,0xc6,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x0e,0x18,0x18,0x18,0x70,0x18,
     0x18,0x18,0x18,0x0e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x18,0x18,0x18,0x18,0x00,0x18,
     0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x70,0x18,0x18,0x18,0x0e,0x18,
     0x18,0x18,0x18,0x70,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x76,0xdc,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x10,0x38,0x6c,0xc6,
     0xc6,0xc6,0xfe,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3c,0x66,0xc2,0xc0,0xc0,0xc0,
     0xc2,0x66,0x3c,0x0c,0x06,0x7c,0x00,0x00},
    {0x00,0x00,0xcc,0x00,0x00,0xcc,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x0c,0x18,0x30,0x00,0x7c,0xc6,0xfe,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x10,0x38,0x6c,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xcc,0x00,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x60,0x30,0x18,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x38,0x6c,0x38,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x3c,0x66,0x60,0x60,
     0x66,0x3c,0x0c,0x06,0x3c,0x00,0x00,0x00},
    {0x00,0x10,0x38,0x6c,0x00,0x7c,0xc6,0xfe,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0x00,0x00,0x7c,0xc6,0xfe,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x60,0x30,0x18,0x00,0x7c,0xc6,0xfe,
     0xc0,0xc0,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x66,0x00,0x00,0x38,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x18,0x3c,0x66,0x00,0x38,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x60,0x30,0x18,0x00,0x38,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0xc6,0x00,0x10,0x38,0x6c,0xc6,0xc6,
     0xfe,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x38,0x6c,0x38,0x00,0x38,0x6c,0xc6,0xc6,
     0xfe,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x18,0x30,0x60,0x00,0xfe,0x66,0x60,0x7c,
     0x60,0x60,0x66,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x6e,0x3b,0x1b,
     0x7e,0xd8,0xdc,0x77,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x3e,0x6c,0xcc,0xcc,0xfe,0xcc,
     0xcc,0xcc,0xcc,0xce,0x00,0x00,0x00,0x00},
    {0x00,0x10,0x38,0x6c,0x00,0x7c,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0x00,0x00,0x7c,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x60,0x30,0x18,0x00,0x7c,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x30,0x78,0xcc,0x00,0xcc,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x60,0x30,0x18,0x00,0xcc,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc6,0x00,0x00,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7e,0x06,0x0c,0x78,0x00},
    {0x00,0xc6,0x00,0x7c,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0xc6,0x00,0xc6,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x18,0x18,0x7e,0xc3,0xc0,0xc0,0xc0,
     0xc3,0x7e,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x38,0x6c,0x64,0x60,0xf0,0x60,0x60,
     0x60,0x60,0xe6,0xfc,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xc3,0x66,0x3c,0x18,0xff,0x18,
     0xff,0x18,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0xfc,0x66,0x66,0x7c,0x62,0x66,0x6f,
     0x66,0x66,0x66,0xf3,0x00,0x00,0x00,0x00},
    {0x00,0x0e,0x1b,0x18,0x18,0x18,0x7e,0x18,
     0x18,0x18,0x18,0x18,0xd8,0x70,0x00,0x00},
    {0x00,0x18,0x30,0x60,0x00,0x78,0x0c,0x7c,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x0c,0x18,0x30,0x00,0x38,0x18,0x18,
     0x18,0x18,0x18,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x18,0x30,0x60,0x00,0x7c,0xc6,0xc6,
     0xc6,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x18,0x30,0x60,0x00,0xcc,0xcc,0xcc,
     0xcc,0xcc,0xcc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x76,0xdc,0x00,0xdc,0x66,0x66,
     0x66,0x66,0x66,0x66,0x00,0x00,0x00,0x00},
    {0x76,0xdc,0x00,0xc6,0xe6,0xf6,0xfe,0xde,
     0xce,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x00,0x3c,0x6c,0x6c,0x3e,0x00,0x7e,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x38,0x6c,0x6c,0x38,0x00,0x7c,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x60,
     0xc0,0xc6,0xc6,0x7c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0xfe,0xc0,
     0xc0,0xc0,0xc0,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0xfe,0x06,
     0x06,0x06,0x06,0x00,0x00,0x00,0x00,0x00},
    {0x00,0xc0,0xc0,0xc2,0xc6,0xcc,0x18,0x30,
     0x60,0xce,0x9b,0x06,0x0c,0x1f,0x00,0x00},
    {0x00,0xc0,0xc0,0xc2,0xc6,0xcc,0x18,0x30,
     0x66,0xce,0x96,0x3e,0x06,0x06,0x00,0x00},
    {0x00,0x00,0x18,0x18,0x00,0x18,0x18,0x18,
     0x3c,0x3c,0x3c,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x36,0x6c,0xd8,
     0x6c,0x36,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xd8,0x6c,0x36,
     0x6c,0xd8,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x11,0x44,0x11,0x44,0x11,0x44,0x11,0x44,
     0x11,0x44,0x11,0x44,0x11,0x44,0x11,0x44},
    {0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,
     0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa},
    {0xdd,0x77,0xdd,0x77,0xdd,0x77,0xdd,0x77,
     0xdd,0x77,0xdd,0x77,0xdd,0x77,0xdd,0x77},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xf8,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0xf8,0x18,0xf8,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xf6,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfe,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x00,0x00,0x00,0x00,0x00,0xf8,0x18,0xf8,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x36,0x36,0x36,0x36,0x36,0xf6,0x06,0xf6,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x00,0x00,0x00,0x00,0x00,0xfe,0x06,0xf6,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0xf6,0x06,0xfe,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xfe,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x18,0x18,0x18,0x18,0x18,0xf8,0x18,0xf8,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf8,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1f,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1f,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xff,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x1f,0x18,0x1f,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x37,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0x37,0x30,0x3f,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x3f,0x30,0x37,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0xf7,0x00,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xff,0x00,0xf7,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0x37,0x30,0x37,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x00,0x00,0x00,0x00,0x00,0xff,0x00,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x36,0x36,0x36,0x36,0x36,0xf7,0x00,0xf7,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x18,0x18,0x18,0x18,0x18,0xff,0x00,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xff,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0xff,0x00,0xff,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x3f,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x18,0x18,0x18,0x18,0x18,0x1f,0x18,0x1f,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x1f,0x18,0x1f,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xff,
     0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36},
    {0x18,0x18,0x18,0x18,0x18,0xff,0x18,0xff,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xf8,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
     0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,
     0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff},
    {0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,
     0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xf0},
    {0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,
     0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f},
    {0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x76,0xdc,0xd8,
     0xd8,0xd8,0xdc,0x76,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x78,0xcc,0xcc,0xcc,0xd8,0xcc,
     0xc6,0xc6,0xc6,0xcc,0x00,0x00,0x00,0x00},
    {0x00,0x00,0xfe,0xc6,0xc6,0xc0,0xc0,0xc0,
     0xc0,0xc0,0xc0,0xc0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0xfe,0x6c,0x6c,0x6c,
     0x6c,0x6c,0x6c,0x6c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0xfe,0xc6,0x60,0x30,0x18,
     0x30,0x60,0xc6,0xfe,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7e,0xd8,0xd8,
     0xd8,0xd8,0xd8,0x70,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,
     0x66,0x7c,0x60,0x60,0xc0,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x76,0xdc,0x18,0x18,
     0x18,0x18,0x18,0x18,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x7e,0x18,0x3c,0x66,0x66,
     0x66,0x3c,0x18,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x38,0x6c,0xc6,0xc6,0xfe,
     0xc6,0xc6,0x6c,0x38,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x38,0x6c,0xc6,0xc6,0xc6,0x6c,
     0x6c,0x6c,0x6c,0xee,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x1e,0x30,0x18,0x0c,0x3e,0x66,
     0x66,0x66,0x66,0x3c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x7e,0xdb,0xdb,
     0xdb,0x7e,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x03,0x06,0x7e,0xdb,0xdb,
     0xf3,0x7e,0x60,0xc0,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x1c,0x30,0x60,0x60,0x7c,0x60,
     0x60,0x60,0x30,0x1c,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x7c,0xc6,0xc6,0xc6,0xc6,
     0xc6,0xc6,0xc6,0xc6,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0xfe,0x00,0x00,0xfe,
     0x00,0x00,0xfe,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x18,0x18,0x7e,0x18,
     0x18,0x00,0x00,0xff,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x30,0x18,0x0c,0x06,0x0c,
     0x18,0x30,0x00,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x0c,0x18,0x30,0x60,0x30,
     0x18,0x0c,0x00,0x7e,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x0e,0x1b,0x1b,0x18,0x18,0x18,
     0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
     0xd8,0xd8,0xd8,0x70,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x7e,
     0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x76,0xdc,0x00,
     0x76,0xdc,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x38,0x6c,0x6c,0x38,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,
     0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x0f,0x0c,0x0c,0x0c,0x0c,0x0c,0xec,
     0x6c,0x6c,0x3c,0x1c,0x00,0x00,0x00,0x00},
    {0x00,0xd8,0x6c,0x6c,0x6c,0x6c,0x6c,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x70,0xd8,0x30,0x60,0xc8,0xf8,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x7c,0x7c,0x7c,0x7c,
     0x7c,0x7c,0x7c,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
  };



/*********/
/* ESTAT */
/*********/

// Per a convertir.
static struct
{
  
  GIConv  cd;
  char   *buf;
  size_t  bsize;
  
} _tocp437;


/*********************/
/* FUNCIONS PRIVADES */
/*********************/

static void
close_tocp437 (void)
{
  
  g_iconv_close ( _tocp437.cd );
  g_free ( _tocp437.buf );
  
} // end close_tocp437


static void
init_tocp437 (void)
{
  
  _tocp437.cd= g_iconv_open ( "CP437", "UTF-8" );
  if ( _tocp437.cd == (GIConv) -1 )
    error ( "vgafont: no s'ha pogut crear el conversor de caràcters" );
  _tocp437.buf= g_new ( char, 1 );
  _tocp437.bsize= 1;
  
} // end init_tocp437


static const char *
to_cp437 (
          const char *string,
          int        *olength
          )
{
  
  int len;
  gsize ileft, oleft, ret;
  char *itmp, *otmp;
  
  
  // Obté longitut i prepara buffer.
  len= strlen ( string );
  if ( _tocp437.bsize < (len+1) )
    {
      _tocp437.bsize= len+1;
      _tocp437.buf= g_renew ( char, _tocp437.buf, _tocp437.bsize );
    }

  // Fa la transformació.
  ileft= oleft= len;
  itmp= (char *) string; otmp= &(_tocp437.buf[0]);
  ret= g_iconv ( _tocp437.cd, &itmp, &ileft, &otmp, &oleft );
  if ( ret == (gsize) -1 )
    {
      warning ( "vgafont: no s'ha pogut transformar a"
                " CP437 la cadena: '%s'", string );
      *olength= len;
      return string;
    }
  else
    {
      _tocp437.buf[len-oleft]= '\0';
      *olength= len-oleft;
      return _tocp437.buf;
    }
  
} // end to_cp437


static void
draw_tile (
           int                 *fb,
           const int            fb_width,
           const unsigned char  tile,
           const int            x,
           const int            y,
           const int            fgcolor,
           const int            bgcolor,
           const int            flags
           )
{
  
  int offset, r, c;
  const unsigned char *pat;
  unsigned char byte,tmp;
  
  
  pat= TILES[tile];
  offset= (flags&VGAFONT_XY_PIXELS)!=0 ? y*fb_width + x : y*16*fb_width + x*9;
  for ( r= 0; r < 16; ++r )
    {
      byte= tmp= pat[r];
      // Dibuixa caràcter
      for ( c= 0; c < 8; ++c )
        {
          if ( tmp&0x80 )
            {
              if ( !(flags&VGAFONT_FG_TRANS) ) fb[offset+c]= fgcolor;
            }
          else
            {
              if ( !(flags&VGAFONT_BG_TRANS) ) fb[offset+c]= bgcolor;
            }
          tmp<<= 1;
        }
      // Dibuixa columna 9 (els caràcters C0-DF repliquen l'última
      // columna la resta fica a fg)
      if ( tile >= 0xC0 && tile <= 0xDF )
        {
          if ( byte&0x01 )
            {
              if ( !(flags&VGAFONT_FG_TRANS) ) fb[offset+8]= fgcolor;
            }
          else
            {
              if ( !(flags&VGAFONT_BG_TRANS) ) fb[offset+8]= bgcolor;
            }
        }
      else
        {
          if ( !(flags&VGAFONT_BG_TRANS) ) fb[offset+8]= bgcolor;
        }
      offset+= fb_width;
    }
  
} // end draw_tile




/**********************/
/* FUNCIONS PÚBLIQUES */
/**********************/

void
close_vgafont (void)
{
  close_tocp437 ();
} // end close_vgafont


void
init_vgafont (void)
{
  init_tocp437 ();
} // end init_vgafont


void
vgafont_draw_string (
                     int        *fb,
                     const int   fb_width,
                     const char *string,
                     int         x,
                     const int   y,
                     const int   fgcolor,
                     const int   bgcolor,
                     const int   flags
                     )
{

  const char *p;
  int inc;


  inc= flags&VGAFONT_XY_PIXELS ? 9 : 1;
  for ( p= string; *p; ++p, x+= inc )
    draw_tile ( fb, fb_width, (unsigned char) *p,
                x, y, fgcolor, bgcolor, flags );
  
} // end vgafont_draw_string


int
vgafont_draw_string_utf8 (
                          int        *fb,
                          const int   fb_width,
                          const char *string,
                          int         x,
                          const int   y,
                          const int   fgcolor,
                          const int   bgcolor,
                          const int   flags
                          )
{

  const char *tmp;
  int ret;
  

  tmp= to_cp437 ( string, &ret );
  vgafont_draw_string ( fb, fb_width, tmp,
                        x, y, fgcolor, bgcolor, flags );

  return ret;
  
} // end vgafont_draw_string_utf8
